#!/usr/bin/env bash

# Definindo cores
RED='\e[31m'
GREEN='\e[32m'
YELLOW='\e[33m'
NC='\e[0m' # No Color

echo -e "${GREEN}Dando permissÃµes de leitura e execuÃ§Ã£o...${NC}"

echo -e "${YELLOW}- chmod u+w -R ./var${NC}"
chmod u+w -R ./var 

echo -e "${YELLOW}- chmod u+w -R ./vendor${NC}"
# chmod u+w -R ./vendor 

echo -e "${YELLOW}- chmod u+w -R ./static${NC}"
chmod u+w -R ./pub/static 

echo -e "${YELLOW}- chmod u+w -R ./media${NC}"
chmod u+w -R ./pub/media 

echo -e "${YELLOW}- chmod u+w -R ./etc${NC}"
chmod u+w -R ./app/etc

echo -e "${YELLOW}- chmod u+x ./bin/magento${NC}"
chmod u+x ./bin/magento

echo -e "${GREEN}Instalando Magento...${NC}"

php -f ./bin/magento setup:install --base-url=http://localhost/ \
    --db-host=db \
    --db-name=magento \
    --db-user=magento \
    --db-password=magento \
    --admin-firstname=Magento \
    --admin-lastname=Commerce \
    --admin-email=user@example.com \
    --admin-user=admin \
    --admin-password=admin123 \
    --language=pt_BR \
    --currency=BRL \
    --timezone=America/Fortaleza \
    --use-rewrites=1 \
    --use-sample-data \
    --backend-frontname=admin \
    # --use-sample-data \

echo -e "${GREEN}Configurando para usar Redis em cache e sessÃ£o...${NC}"
mv ./app/etc/env.php ./app/etc/env.original.php;
cp -rv /var/users/env.sample.php ./app/etc/env.php;

echo -e "${GREEN}Instalando cron jobs...${NC}"
n98 cron:install;
php -f ./bin/magento indexer:set-mode schedule;

echo -e "${GREEN}Configurando chaves de autenticaÃ§Ã£o...${NC}"
cp ~/.composer/auth.json var/composer_home/auth.json

# echo -e "${GREEN}Instalando Sample Data...${NC}"
# php -f ./bin/magento sampledata:deploy

echo -e "${GREEN}Rodando setup:upgrade...${NC}"
php -f ./bin/magento setup:upgrade

echo -e "${GREEN}Re-indexando...${NC}"
php -f ./bin/magento indexer:reindex

echo -e "${GREEN}Limpando cache...${NC}"
php -f ./bin/magento cache:flush

# echo -e "${GREEN}Configurando Grunt...${NC}"
# mv package.json.sample package.json ; mv Gruntfile.js.sample Gruntfile.js
# npm i

echo -e "${GREEN}Setando a loja para produÃ§Ã£o...${NC}"
php -f ./bin/magento deploy:mode:set production

echo -e "${GREEN}Refazendo autoload...${NC}"
composer dump-autoload -o

clear

echo "
===================== ðŸš€ Done ðŸš€ ===================

      Magento 2 Installed successfully!

      ðŸŒŽ Admin: http://localhost/admin
      ðŸ‘¤ User: admin
      ðŸ”‘ Password: admin123

===================== ðŸš€ Done ðŸš€ ==================="



# if [ $@ ]; then
#   composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition:$1 . ;
# else
#   composer create-project --repository-url=https://repo.magento.com/ magento/project-community-edition . ;
# fi
# chmod u+w -R ./var ./vendor ./pub/static ./pub/media ./app/etc \
# && chmod u+x ./bin/magento \
# && php -f ./bin/magento setup:install --base-url=http://localhost/ \
#     --db-host=db \
#     --db-name=magento \
#     --db-user=magento \
#     --db-password=magento \
#     --admin-firstname=Magento \
#     --admin-lastname=Commerce \
#     --admin-email=user@example.com \
#     --admin-user=admin \
#     --admin-password=admin123 \
#     --language=en_US \
#     --currency=USD \
#     --timezone=America/Chicago \
#     --use-rewrites=1 \
#     --use-sample-data \
#     --backend-frontname=admin \
#     --use-sample-data \
# && mv ./app/etc/env.php ./app/etc/env.original.php;
# cp -rv /var/users/env.sample.php ./app/etc/env.php;
# n98 cron:install;
# php -f ./bin/magento indexer:set-mode schedule;
# cp ~/.composer/auth.json var/composer_home/auth.json \
# && php -f ./bin/magento sampledata:deploy \
# && php -f ./bin/magento setup:upgrade \
# && php -f ./bin/magento indexer:reindex \
# && php -f ./bin/magento cache:flush;
# mv package.json.sample package.json ; mv Gruntfile.js.sample Gruntfile.js;
# npm i;
# php -f ./bin/magento deploy:mode:set production \
# && composer dump-autoload -o \
# && clear && echo "
# ===================== ðŸš€ Done ðŸš€ ===================

#       Magento 2 Installed successfully!

#       ðŸŒŽ Admin: http://localhost/admin
#       ðŸ‘¤ User: admin
#       ðŸ”‘ Password: admin123

# ===================== ðŸš€ Done ðŸš€ ==================="
